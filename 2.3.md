### **A股量化投研平台 V2.3 - “策略实战与智能风控” 项目规划**

**文档版本：** 1.0
**核心愿景 (Vision):** 如果说 V2.2 是对系统**内部架构**的深度优化，那么 V2.3 的核心就是将我们强大的内部能力，全面**对外实战化**。我们将激活平台最强大的“大脑”——机器学习引擎，并从“选股”的单一维度，升级到“构建投资组合”和“管理风险”的**实战高度**。

---

#### **一、 V2.3 版本核心任务模块**

我们将围绕“实战”和“风控”两大主题，推进四大核心任务模块的开发。

##### **任务模块一：机器学习引擎全面激活 (Full Activation of the ML Engine)**

* **目标：** 彻底“唤醒”我们早已在 `quant_engine.py` 中定义的 `MLAlphaStrategy`，将平台的策略能力从“线性多因子”时代，带入“非线性机器学习”时代。
* **实施步骤：**
    1.  **创建“模型训练室” (UI):** 在 `app.py` 中新增一个独立的“🔬 模型训练室”标签页。
    2.  **实现模型训练 (Backend):** 在新页面中，允许用户选择：
        * **因子(特征)集：** 选择哪些因子将作为特征输入模型。
        * **目标(标签)：** 定义预测目标，例如“未来20日收益率是否能排进市场前20%”。
        * **训练周期：** 选择用于训练的历史时间段。
        * 点击“开始训练”后，后端将调用 `MLAlphaStrategy.train()` 方法，并将训练好的模型（例如一个 `.pkl` 文件）**保存到本地**。
    3.  **集成到回测实验室 (Integration):**
        * 在“🚀 回测实验室”中，为“策略模型”增加“**机器学习 (LGBM)**”选项。
        * 当用户选择此项并点击回测时，系统将**加载已训练好的模型**，在每个调仓日，调用 `MLAlphaStrategy.predict_top_stocks()` 方法，预测出得分最高的N只股票。
        * 系统将这些股票按等权重或按预测概率加权的方式，构建投资组合，并完成回测。

##### **任务模块二：投资组合级风险管理 (Portfolio-Level Risk Management)**

* **目标：** 引入专业的风险模型，让平台从“只会选股”，升级到能够**洞察和管理一个投资组合的系统性风险**。
* **实施步骤：**
    1.  **构建风险因子 (Engine):** 在 `quant_engine.py` 中，创建新的风险因子计算方法。这些不是用于选股的Alpha因子，而是用于风险归因的Beta因子，例如：
        * **市值因子 (Size):** 计算股票的总市值。
        * **估值因子 (Value):** 计算股票的市净率 `pb`。
        * **动量因子 (Momentum):** 计算过去12个月的收益率。
        * **波动率因子 (Volatility):** 计算历史波动率。
    2.  **创建风险管理器 (Engine):** 在 `quant_engine.py` 中创建一个全新的 `RiskManager` 类。这个类可以接收一个包含持仓股票和权重的投资组合，并分析这个组合在上述各类风险因子上的**总暴露度**（例如，“您的持仓整体偏向小盘股”、“您的持仓有很高的动量风险暴露”）。
    3.  **新增“风险暴露分析” (UI):** 在“🚀 回测实验室”的回测结果下方，新增一个“**风险暴露分析**”区域。当回测完成后，这里会通过图表展示出您的策略在整个回测期间，其持仓在市值、估值、动量等风险因子上的暴露度变化曲线。

##### **任务模块三：自动化策略全流程 (End-to-End Automated Strategy Workflow)**

* **目标：** 将我们现有的所有强大模块（因子计算、策略选择、风险分析、AI报告）串联起来，形成一个**每日自动运行、输出实战级投研晨报**的闭环工作流。
* **实施步骤：**
    1.  **创建策略执行脚本:** 创建一个全新的后台脚本，例如 `run_strategy_daily.py`。这个脚本将成为我们平台自动化的大脑，它每天早晨开盘前会自动执行以下操作：
        a.  加载一个预设的策略配置（例如，使用“自适应权重策略”，因子池包含`momentum`, `roe`等）。
        b.  基于最新的因子数据，运行该策略，生成一个**当日的目标持仓组合**。
        c.  将这个目标组合传递给我们新建的 `RiskManager`，进行全面的风险分析。
        d.  将“目标持仓”、“风险分析结果”和“市场关键新闻”打包，发送给 `AIOrchestrator`。
        e.  AI 生成一份**《每日AI投研晨报》**，内容包括：“今日策略建议持仓”、“核心持仓理由”、“潜在风险暴露分析”和“重要市场新闻解读”。
    2.  **集成到调度器:** 将这个 `run_strategy_daily.py` 脚本加入到 `scheduler.py`，设置为每个交易日早晨8点自动运行。
    3.  **新增“策略看板” (UI):** 在 `app.py` 中新增一个“**📈 策略看板**”标签页。这个页面将作为您每日工作的起点，直接展示由后台自动生成的最新**目标持仓列表**和那份图文并茂的**《每日AI投研晨报》**。

##### **任务模块四（展望）：引入高频数据与模拟交易**

* **目标（为V3.0铺垫）：** 为平台引入分钟级数据，打通从“研究”到“模拟交易”的最后一公里。
* **想象空间：**
    * **数据层:** 扩展 `DataManager`，支持分钟级K线数据的获取与存储。
    * **回测引擎:** 升级 `EventDrivenBacktester`，使其能够处理分钟线数据，支持日内交易策略（T+0）的回测。
    * **执行算法:** 模拟实现VWAP（成交量加权平均价）、TWAP（时间加权平均价）等算法交易策略，分析冲击成本。
    * **模拟交易接口:** 预留与券商API对接的接口，为未来实现从“研究”到“下单”的全流程闭环做准备。
